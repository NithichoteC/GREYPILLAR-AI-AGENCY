<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar Buttons Test</title>
    <style>
        body { background: #0f0f0f; color: white; font-family: Arial, sans-serif; padding: 2rem; }
        .test-section { margin: 2rem 0; padding: 1rem; border: 1px solid #333; border-radius: 8px; }
        button { margin: 0.5rem; padding: 0.75rem 1rem; background: #4285f4; color: white; border: none; border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Calendar Button Test</h1>
    
    <div class="test-section">
        <h3>Test 1: Mock Calendar Event Data</h3>
        <button onclick="testCalendarFunctions()">Test Calendar Functions</button>
        <div id="test-results"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 2: Calendar Buttons (Mock)</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0.75rem; max-width: 600px;">
            <button class="calendar-btn" data-calendar="google" style="background: #4285f4;">Google</button>
            <button class="calendar-btn" data-calendar="outlook" style="background: #0078d4;">Outlook</button>
            <button class="calendar-btn" data-calendar="apple" style="background: #333;">Apple</button>
            <button class="calendar-btn" data-calendar="yahoo" style="background: #6001d2;">Yahoo</button>
        </div>
    </div>

    <script>
        // Mock calendar event data
        const mockCalendarEvent = {
            title: 'AI Automation Discovery Call',
            startDate: '2025-01-15T15:00:00Z',
            endDate: '2025-01-15T15:30:00Z',
            description: 'AI automation consultation to identify opportunities in your business',
            location: 'Video Call (link will be provided)',
            attendees: [],
            organizer: 'Nithichote'
        };

        // Extract calendar data function (simplified)
        function extractCalendarData(bookingData) {
            return mockCalendarEvent; // Return mock data for testing
        }

        // Generate calendar URLs function
        function generateCalendarUrls(eventData) {
            if (!eventData || !eventData.startDate) return null;
            
            const startDate = new Date(eventData.startDate);
            const endDate = new Date(eventData.endDate);
            
            const formatGoogleDate = (date) => date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
            
            return {
                google: `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(eventData.title)}&dates=${formatGoogleDate(startDate)}/${formatGoogleDate(endDate)}&details=${encodeURIComponent(eventData.description)}&location=${encodeURIComponent(eventData.location)}`,
                
                outlook: `https://outlook.live.com/calendar/0/deeplink/compose?subject=${encodeURIComponent(eventData.title)}&startdt=${startDate.toISOString()}&enddt=${endDate.toISOString()}&body=${encodeURIComponent(eventData.description)}&location=${encodeURIComponent(eventData.location)}`,
                
                yahoo: `https://calendar.yahoo.com/?v=60&view=d&type=20&title=${encodeURIComponent(eventData.title)}&st=${formatGoogleDate(startDate)}&et=${formatGoogleDate(endDate)}&desc=${encodeURIComponent(eventData.description)}&in_loc=${encodeURIComponent(eventData.location)}`,
                
                ics: generateICSFile(eventData)
            };
        }

        // Generate ICS file
        function generateICSFile(eventData) {
            const startDate = new Date(eventData.startDate);
            const endDate = new Date(eventData.endDate);
            const now = new Date();
            
            const formatICSDate = (date) => date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
            
            const icsContent = [
                'BEGIN:VCALENDAR',
                'VERSION:2.0',
                'PRODID:-//AI Automation Consultant//Calendar Event//EN',
                'BEGIN:VEVENT',
                `UID:${Date.now()}@nithichote.com`,
                `DTSTAMP:${formatICSDate(now)}`,
                `DTSTART:${formatICSDate(startDate)}`,
                `DTEND:${formatICSDate(endDate)}`,
                `SUMMARY:${eventData.title}`,
                `DESCRIPTION:${eventData.description}`,
                `LOCATION:${eventData.location}`,
                'END:VEVENT',
                'END:VCALENDAR'
            ].join('\r\n');
            
            return 'data:text/calendar;charset=utf8,' + encodeURIComponent(icsContent);
        }

        // Test function
        function testCalendarFunctions() {
            console.log('ðŸ§ª Testing calendar functions...');
            
            const eventData = extractCalendarData({});
            console.log('âœ… Calendar event data:', eventData);
            
            const urls = generateCalendarUrls(eventData);
            console.log('âœ… Calendar URLs:', urls);
            
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = `
                <h4>Test Results:</h4>
                <p><strong>Event:</strong> ${eventData.title}</p>
                <p><strong>Date:</strong> ${eventData.startDate}</p>
                <p><strong>URLs Generated:</strong> ${Object.keys(urls).length}</p>
                <p><strong>Google URL:</strong> <a href="${urls.google}" target="_blank" style="color: #4285f4;">Test Google Calendar</a></p>
                <p><strong>Outlook URL:</strong> <a href="${urls.outlook}" target="_blank" style="color: #0078d4;">Test Outlook Calendar</a></p>
                <p><strong>Yahoo URL:</strong> <a href="${urls.yahoo}" target="_blank" style="color: #6001d2;">Test Yahoo Calendar</a></p>
            `;
        }

        // Initialize calendar buttons
        document.addEventListener('DOMContentLoaded', function() {
            localStorage.setItem('calendarEventData', JSON.stringify(mockCalendarEvent));
            
            const calendarButtons = document.querySelectorAll('.calendar-btn');
            
            calendarButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const calendarType = this.getAttribute('data-calendar');
                    console.log(`ðŸ“… ${calendarType} calendar button clicked`);
                    
                    const eventData = JSON.parse(localStorage.getItem('calendarEventData'));
                    const urls = generateCalendarUrls(eventData);
                    
                    if (urls && urls[calendarType]) {
                        if (calendarType === 'apple') {
                            const link = document.createElement('a');
                            link.href = urls.ics;
                            link.download = 'ai-automation-discovery-call.ics';
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                            console.log('âœ… ICS file downloaded for Apple Calendar');
                        } else {
                            window.open(urls[calendarType], '_blank');
                            console.log(`âœ… ${calendarType} calendar opened`);
                        }
                    }
                });
            });
            
            console.log('âœ… Calendar buttons test initialized');
        });
    </script>
</body>
</html>